syntax = "proto2";

package websocket;

option optimize_for = SPEED;

message Challenge {
  required bytes nonce = 1;
}

message ChallengeResponse {
  required string handle = 1;
  required bytes signature = 2;
}

message PQXDHInit {
  required bytes id_key = 1;
  required bytes ephemeral_key = 2;
  required bytes pqkem_ciphertext = 3;
  repeated int64 prekey_ids = 4 [packed=true];
  required bytes initial_ciphertext = 5;
}

message Forward {
  required string handle = 1;
  oneof payload {
    PQXDHInit pqxdh_init = 2;
  }
}

message Envelope {
  oneof payload {
    Challenge challenge = 1; // server -> client
    ChallengeResponse challenge_response = 2; // client -> server
    Forward forward = 3; // client -> server -> client
  }
}
