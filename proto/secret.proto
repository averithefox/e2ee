syntax = "proto2";

package secret;

option optimize_for = SPEED;

message Attachment {
  required int64 id = 1;
  required string mime_type = 2;
  required bytes data = 3;
}

message Message {
  required int64 id = 1;
  optional string text = 2;
  repeated Attachment attachments = 3;
  optional int64 reply_to = 4;
  required int64 timestamp = 5;
}

message MsgEdit {
  required int64 id = 1;
  optional string text = 2;
  repeated int64 attachment_ids = 3;
  required int64 timestamp = 4;
}

message MsgDelete {
  required int64 id = 1;
}

message Receipt {
  oneof type {
    int64 received = 1;
    int64 seen = 2;
  }
}

message Payload {
  oneof type {
    Message msg_new = 2;
    MsgEdit msg_edit = 3;
    MsgDelete msg_delete = 4;
    Receipt receipt = 5;
  }
}
